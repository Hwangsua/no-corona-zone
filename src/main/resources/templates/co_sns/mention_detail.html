<!DOCTYPE html>
<html lang="ko"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/common_layout}" th:with="activeTab='timeline', title='Timeline'">
<head>
    <meta charset="UTF-8">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <link th:href="@{/css/co_sns/mention_detail.css}" rel="stylesheet">
    <script src='//cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.7.0/js/md5.min.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/jdenticon@3.0.1" async> </script>
    <script>
        $(document).ready(function () {

            $('#remention-save-btn').click(function () {

                console.log($('#content').val().length);
                if($('#content').val().replace(/\s| /gi, "").length==0){
                    alert("내용을 입력해주세요.");
                    return false;
                }

                document.getElementById("parent-mention-no").value= $('#parent-mention').val();

                var token = $("meta[name='_csrf']").attr("content");
                var header = $("meta[name='_csrf_header']").attr("content");

                $.ajax({
                    url : '/remention',
                    type : 'POST',
                    data : $('#re-mention-form').serialize(),
                    beforeSend: function (xhr){
                        xhr.setRequestHeader(header, token);
                    },
                }).done(function (fragment) {

                    $("#re-mention-list").replaceWith(fragment);
                    document.getElementById("content").value= null;
                });
            });

            $(".identicon").each(function () {
                var hash = md5($(this).data('id')).toString();
                var data = new Identicon(hash, {format: 'svg'}).toString();
                $(this).attr('src', "data:image/svg+xml;base64," + data);
            });
        });


    </script>
</head>
<body>
<div layout:fragment="content">
    <div class="container-mention">
        <div class="mention-detail">
            <div class="mention-header">
                <div onclick="location.href='/timeline_follow'" class="back-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="none" stroke="#000"
                         stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M19 12H6m6-7l-7 7 7 7"></path>
                    </svg>
                </div>
                <p class="mention">멘션</p>
            </div>
            <div class="hr"></div>
            <div class="mention-and-remention">
                <input type="hidden" th:value="${mention.no}" id="parent-mention">
                <div class="mention-content" >
                    <div class="mention-top">
                        <div class="profile-img">
                            <svg data-jdenticon-value="user" th:data-jdenticon-value="${mention.member.nickname}"
                                 width="60" height="60" class="rounded border bg-light"></svg>
                        </div>
                        <div class="nickname-box">
                            <a href="" class="nickname" th:text="${mention.member.nickname}">닉네임</a>
                        </div>
                        <div class="vaccine">
                            <img src="img/vaccine.png" alt="" class="vaccine">
                        </div>
                    </div>
                    <div class="mention-bottom">
                        <div class="content" th:text="${mention.content}">가나다라마바다아자차카타파하!!!!!!!!가나다라마바다아자차카타</div>
                        <div class="mention-info">
                            <div class="upload-time" th:text="${#temporals.format(mention.regdate,'yyyy.MM.dd HH:mm')}">2021년 8월 22일 오후 4:27</div>
                            <div class="dot">·</div>
                            <div class="location" th:text="${mention.location}">롯데월드</div>
                        </div>
                        <div align="left" class="mention-delete" th:if="${member.no==mention.member.no}">
                            <form id="delete-form" th:action="@{'/delete/' + ${mention.no}}" method="post">
                                <input type="hidden" name="delete_mention" value="delete"/>
                                <button id="delete-btn">삭제</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="remention-content" >
                    <form id="re-mention-form" th:object="${reMentionForm}" >
                        <input type="hidden" th:field="*{parentMentionNo}" id="parent-mention-no">
                        <div class="profile-img">
                            <svg data-jdenticon-value="user" th:data-jdenticon-value="${member.nickname}"
                                 width="60" height="60" class="rounded border bg-light"></svg>
                        </div>
                        <div class="remention-write">
                            <textarea name="content" id="content" th:field="*{content}" placeholder="답글을 적어주세요."></textarea>
                        </div>
                        <div class="remention-write-submit" id="remention-save-btn">
                            <div class="remention-btn">
                                <p class="remention-btn-text" >말하기</p>
                            </div>

                        </div>
                    </form>
                </div>
                <div id = "re-mention-list">
                    <div th:each="reMention:${reMentionList}">
                        <div class="re-mention-info">
                            <svg data-jdenticon-value="user" th:data-jdenticon-value="${member.nickname}"
                                 width="60" height="60" class="rounded border bg-light"></svg>
                            <div id="re-mention-nickname" th:text="${reMention.member.nickname}">닉네임</div>
                            <div id="re-mention-content" th:text="${reMention.content}">내용</div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="sidebar">
            <div class="search">
                <form method="get" name="search-mention" th:action="@{search}">
                    <input type="text" class="search-mention" name="keyword" placeholder="멘션 검색하기">
                </form>
            </div>
            <div class="trend">
                <div class="trend-box">
                    <div class="trend-head">
                        실시간 트렌드
                    </div>
                    <div class="trend-rank 1">1</div>
                    <div class="trend-rank 2">2</div>
                    <div class="trend-rank 3">3</div>
                    <div class="trend-rank 4">4</div>
                    <div class="trend-rank 5">5</div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
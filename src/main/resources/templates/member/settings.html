<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout/common_layout}" th:with="activeTab='settings', title='cosns'">
<head>
  <link th:href="@{/css/member/settings.css}" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/jdenticon@3.0.1" async> </script>
  <script th:inline="javascript">
    $(document).ready(function (){
      if([[${result}]]) {
        alert('저장 성공!');
      }
      let nicknameRegexCheck = true;
      let nicknameDuplicateCheck = false;
      $("#nickname").on('focus',function (){
        nicknameDuplicateCheck = false;
        nicknameRegexCheck = false;
      });
      $("#nickname").on('blur',function (){
        let nickname = $('#nickname').val();
        const nicknameRegex = /^[a-zA-Z가-힣]+[0-9a-zA-Z가-힣]{3,7}$/;
        if(nicknameRegex.test(nickname)){
          $('#nicknameCheck').text('');
          nicknameRegexCheck = true;
        }else{
          $('#nicknameCheck').text('닉네임은 영어 또는 한글로 시작하는 4자 이상 8자 이하여야합니다.');
          $('#nicknameCheck').css('color','red');
        }
      });
      $("#nickname-duplicate-check").click(function () {
        let nickname = $('#nickname').val();
        console.log(nickname);
        if(!nicknameRegexCheck){
          alert('닉네임은 영어 또는 한글로 시작하는 4자 이상 8자 이하여야합니다.');
          return false;
        }
        $.ajax({
          url : '/nicknameCk',
          type : 'GET',
          data : {'nickname':nickname},
          contentType : 'application/json',
          dataType: 'json',
          success:function (result){
            alert(result.message);
            nicknameDuplicateCheck = true;
          },
          error:function (){
            alert('error');
          }
        });
      });
      $('.signup-complete').click(function (){
        let password = $('#password').val();
        let passwordCheck = $('#password-ck').val();
        if(password == '' || passwordCheck == '') {
          alert('패스워드 입력하세요');
          return false;
        }
        if(password != passwordCheck){
          alert('두 패스워드가 일치하지 않습니다.');
          return false;
        }
        if(!nickname-duplicate-check){
          alert('닉네임 중복 확인해주세요.');
          return false;
        }
        $('form[name=signup]').submit();
      });
    });
  </script>
</head>
<body>
<div layout:fragment="content">
  <div class="container">
    <form th:action="@{/settings}" method="post" name="settings">
      <div class="settings-header">
        <div class="header-item1">정보수정</div>
        <div class="header-item2">
          <button class="btn-style" type="submit">저장</button>
        </div>
      </div>
      <div class="hr"></div>
      <div class="none" style="visibility: hidden;height: 25px"></div>
      <div class="content">
        <!--                <form action="" method="post" name="signup" th:object="${settingForm}" th:action="@{settings}">-->
        <div class="content-list">
          <label for="email" class="content-name">아이디</label>
          <div class="content-name-value">
            <input type="text" class="form-control" id="email" name="email" th:value="${member.email}" disabled>
          </div>
        </div>
        <div class="content-list">
          <label for="nickname" class="content-name">닉네임</label>
          <div class="content-name-value" style="display: flex">
            <input type="text" th:value="${member.nickname}" name="nickname" class="form-control" id="nickname" style="width: 160px">
            <button type="button" id="nickname-duplicate-check">중복확인</button>
            <div class="check_font" id="nickname-check"></div>
          </div>
        </div>
        <div class="content-list">
          <label for="password" class="content-name">비밀번호</label>
          <div class="content-name-value">
            <input type="password" name="password" class="form-control" id="password" placeholder="비밀번호를 입력하세요.">
          </div>
        </div>
        <div class="content-list">
          <label for="password-ck" class="content-name">비밀번호 확인</label>
          <div class="content-name-value">
            <input type="password" name="user-pw-ck" class="form-control" id="password-ck" placeholder="비밀번호를 다시 입력하세요.">
          </div>
        </div>
        <div class="content-list">
          <label for="introduce" class="content-name">자기소개</label>
          <div class="content-name-value">
            <input type="text" name="introduce" class="form-control" id="introduce" placeholder="내용을 입력해주세요">
          </div>
        </div>
        <div class="content-list-small">
          <span class="content-name">프로필 사진</span>
        </div>
        <div class="content-list content-img">
          <div class="content-name">
            <div class="profile">
              <svg data-jdenticon-value="user127" th:text="${member.email}"
                   width="75" height="75" class="rounded border bg-light"></svg>
            </div>
          </div>
          <div class="content-name-value">
            <label for="profile-img" class="upload-btn">upload</label>
            <input type="file" class="form-control"
                   id="profile-img" name="img" style="display: none">
          </div>
        </div>
        <div class="content-list-small">
          <span class="content-name">백신 이미지</span>
        </div>
        <div class="content-list content-img">
          <div class="content-name">
            <div class="vaccine"></div>
          </div>
          <div class="content-name-value">
            <label for="vaccine-img" class="upload-btn">upload</label>
            <input type="file" class="form-control"
                   id="vaccine-img" name="vaccine-img" style="display: none">
          </div>
        </div>
        <!--                </form>-->
      </div>
    </form>
  </div>
</div>
</body>